Telegram‑бот на Go для электронной очереди, который удовлетворяет вашим требованиям. Ниже описана архитектура, основные функции и инструкция по запуску. В конце сообщения вы найдёте файлы с исходным кодом (bot и go.mod), которые можно скачать.

Ключевые особенности и архитектура
 • Запрос телефона. При первом запуске пользователь получает кнопку «Отправить телефон». В Telegram параметр request_contact клавиши KeyboardButton позволяет пользователю отправить свой номер телефона, нажатие этой кнопки автоматически передаёт телефон в бота ￼.
 • База данных SQLite. Бот использует SQLite как лёгкую файловую СУБД. Подключение осуществляется через стандартный пакет database/sql и драйвер modernc.org/sqlite, что позволяет работать без C‑кодовой зависимости; база создаётся вызовом sql.Open("sqlite", path) ￼. Таблицы users и slots создаются при инициализации посредством db.Exec ￼.
 • Настройка расписания. Администратор задаёт:
 • время начала и окончания рабочего дня (WORK_START, WORK_END);
 • длительность слота (SLOT_DURATION, в минутах);
 • сколько дней вперёд строится расписание (SCHEDULE_DAYS).
Для каждого дня генерируются интервалы, которые хранятся в таблице slots. Неиспользуемые слоты автоматически добавляются при выборе даты.
 • Бронирование и уведомления. При выборе даты пользователь видит свободные слоты. После бронирования:

 1. слот помечается занятым в базе;
 2. с помощью time.AfterFunc планируется отправка уведомления на время начала слота: это встроенный способ Go запускать отложенные задачи без внешнего cron ￼;
 3. бот информирует пользователя, что бронь подтверждена.
 • Работа через webhooks. Вместо долгого опроса, бот получает обновления от Telegram через webhook (это требует доступного извне HTTPS‑сервера на портах 443, 80, 88 или 8443 ￼). URL для webhook задаётся через переменную WEBHOOK_URL.
 • Очереди в памяти. Бот использует каналы Go и time.AfterFunc для планирования отправки сообщений. Никаких внешних брокеров (Redis) нет; данные для бронирования хранятся в SQLite, а уведомления — в памяти до момента отправки.
 • Cron и очистка. По сути, отложенная отправка уведомлений реализована средствами Go (time.AfterFunc), поэтому отдельный cron не нужен. При перезапуске бота функция reschedulePending считывает из базы все будущие бронирования и снова планирует уведомления, чтобы они не потерялись.

Настройка и запуск

 1. Установите Go ≥1.18 и создайте токен Telegram‑бота через BotFather.
 2. Создайте каталог для проекта и распакуйте файлы, скачанные из сообщения:
 • main.go — код бота.
 • go.mod — файл go.mod.
 3. Установите зависимости (go mod tidy).
 4. Задайте в переменных окружения:
 • TELEGRAM_TOKEN — токен бота.
 • WEBHOOK_URL — полный URL вашего HTTPS‑webhook (например, <https://example.com/webhook>).
 • WORK_START и WORK_END — рабочее время в формате HH:MM (например, 09:00 и 18:00).
 • SLOT_DURATION — длительность слота в минутах (например, 30).
 • SCHEDULE_DAYS — сколько дней вперёд генерировать расписание (по умолчанию 7).
 • DB_FILE (опционально) — путь к файлу SQLite; по умолчанию queue.db.
 5. Соберите и запустите: go run main.go.

Когда пользователь впервые нажимает кнопку в боте, он отправляет свой номер телефона. Далее пользователь может выбрать дату и конкретное свободное время. Незадолго до начала слота бот автоматически отправит уведомление, что его очередь подошла.
